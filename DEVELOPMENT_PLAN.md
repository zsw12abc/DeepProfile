# DeepProfile Chrome Extension 开发文档

本文档旨在指导 AI 助手一步步完成 DeepProfile Chrome 插件的开发。本项目用于在知乎页面分析用户画像，辅助理性交流。

## 1. 项目概述
*   **项目名称**: DeepProfile
*   **核心功能**: 监听知乎评论区 -> 提取用户 ID -> 抓取用户动态 -> 调用 LLM 分析 -> 展示用户画像。
*   **目标平台**: Chrome 浏览器 (Manifest V3)。

## 2. 技术栈规范
*   **语言**: TypeScript (必须，确保类型安全)。
*   **构建工具**: Vite 或 Plasmo (推荐 Plasmo，因为它对 Chrome 插件开发支持最好)。
*   **UI 框架**: React 或 Preact (轻量级)。
*   **测试框架**: Vitest (单元测试)。
*   **包管理器**: pnpm 或 npm。

## 3. 敏感数据与安全
*   **原则**: 任何 API Key 均不得硬编码在代码中。
*   **存储**: 所有敏感配置（API Key, Base URL）必须存储在 `chrome.storage.local` 中。
*   **版本控制**: `.env` 文件及包含密钥的测试文件必须加入 `.gitignore`。

## 4. 模块化开发路线图

请 AI 开发者按照以下阶段顺序执行，**每个阶段完成后必须通过自动化测试才能进入下一阶段**。

### 阶段一：项目脚手架与配置模块 (✅ 已完成)
- [x] 初始化项目结构
- [x] 实现 `ConfigService`
- [x] 完成设置页面 (Options Page)

### 阶段二：知乎数据获取模块 (✅ 已完成)
- [x] 实现 `ZhihuClient`
- [x] 数据清洗与截断
- [x] 上下文感知 (Context-Aware)

### 阶段三：AI 服务集成 (✅ 已完成)
- [x] 对接 OpenAI/DeepSeek/Qwen/Gemini/Ollama
- [x] 实现 Prompt 工程 (价值取向分析)
- [x] 标签系统 (LabelService)

### 阶段四：UI 注入与交互 (✅ 已完成)
- [x] 知乎评论区/主页注入
- [x] Reddit 注入 (初步支持)
- [x] 结果展示卡片 (ProfileCard)

### 阶段五：基础功能完善 (✅ 已完成)
- [x] 历史记录与缓存 (History Service)
- [x] 导出与分享 (Export Service)
- [x] UI/UX 细节优化

### 阶段六：评论区舆情总结 (🚧 当前重点 v0.5)
**目标**: 提供当前评论区的宏观舆论概览，帮助用户快速了解争议焦点。

1.  **数据提取 (DOM Extraction)**:
    *   **策略**: 仅解析当前页面已加载的评论 DOM 元素，**不调用知乎 API**，彻底规避风控风险。
    *   **内容**: 提取评论者昵称、评论正文、点赞数（作为权重参考）。
    *   **适配**: 支持回答下方的折叠评论区和文章底部的评论区。
2.  **舆情分析服务 (Comment Analysis Service)**:
    *   **Prompt 工程**: 设计专门的 Prompt，用于分析“观点阵营”、“主要论点”和“情绪倾向”。
    *   **输出结构**: 
        *   支持方/反对方/中立吃瓜比例。
        *   核心争议点总结。
        *   典型评论摘录。
3.  **UI 交互**:
    *   **注入点**: 在评论区顶部（Header 区域）添加“📊 总结本页观点”按钮。
    *   **展示**: 独立的分析结果卡片，展示饼图或进度条及文字总结。

### 阶段七：多平台扩展 (📅 暂缓)
**目标**: 探索更多平台支持。

- [ ] **Bilibili**: 评论区与动态分析。
- [ ] **微博**: 用户主页分析。
- [ ] **Twitter/X**: 英文推文分析。

## 5. 给 AI 的开发指令示例

当你开始开发时，请遵循以下模式：

> "我现在开始开发**阶段六**。首先，我将创建 `CommentAnalysisService.ts` 用于定义 Prompt 和分析逻辑。接着，我将实现 DOM 提取器。"

每次提交代码前，必须运行 `npm test` 或 `pnpm test` 确保测试通过。
